# ============================================================================
# MySQL {{cookiecutter._mysql_version}} Backup - Imagen oficial con cron
# ============================================================================
# Documentación: https://dev.mysql.com/doc/refman/8.0/en/mysqldump.html
# Herramienta: mysqldump (incluida en imagen oficial)
# ============================================================================
FROM mysql:{{cookiecutter._mysql_version}}

LABEL maintainer="edugonmor"
LABEL description="MySQL Backup Service with mysqldump and cron"
LABEL version="{{cookiecutter._mysql_version}}"

# Instalar cron en BUILD TIME (no en runtime)
RUN microdnf update && microdnf install -y \
    cronie \
    gzip \
    findutils \
    && microdnf clean all

# Copiar scripts de backup
COPY docker/scripts/backup.sh /usr/local/bin/backup.sh
COPY docker/scripts/restore.sh /usr/local/bin/restore.sh
COPY docker/scripts/entrypoint-backup.sh /usr/local/bin/entrypoint-backup.sh

# Dar permisos de ejecución
RUN chmod +x /usr/local/bin/backup.sh \
    /usr/local/bin/restore.sh \
    /usr/local/bin/entrypoint-backup.sh

# Crear directorio de backups
RUN mkdir -p /backups

# Usar entrypoint personalizado que configura cron
ENTRYPOINT ["/usr/local/bin/entrypoint-backup.sh"]
