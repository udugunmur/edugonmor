# ============================================================================
# MariaDB {{cookiecutter.mariadb_version}} Backup - Imagen oficial con cron
# ============================================================================
# Documentación: https://mariadb.com/docs/server/server-usage/backup-and-restore/backup-and-restore-overview/#mariadb-dump
# Herramienta: mariadb-dump (incluida en imagen oficial)
# ============================================================================
FROM mariadb:{{cookiecutter.mariadb_version}}

LABEL maintainer="edugonmor"
LABEL description="MariaDB Backup Service with mariadb-dump and cron"
LABEL version="{{cookiecutter.mariadb_version}}"

# Instalar cron en BUILD TIME (no en runtime)
RUN apt-get update && apt-get install -y \
    cron \
    && rm -rf /var/lib/apt/lists/*

# Copiar scripts de backup
COPY docker/scripts/backup.sh /usr/local/bin/backup.sh
COPY docker/scripts/restore.sh /usr/local/bin/restore.sh
COPY docker/scripts/entrypoint-backup.sh /usr/local/bin/entrypoint-backup.sh

# Dar permisos de ejecución
RUN chmod +x /usr/local/bin/backup.sh \
    /usr/local/bin/restore.sh \
    /usr/local/bin/entrypoint-backup.sh

# Crear directorio de backups
RUN mkdir -p /backup

# Usar entrypoint personalizado que configura cron
ENTRYPOINT ["/usr/local/bin/entrypoint-backup.sh"]
