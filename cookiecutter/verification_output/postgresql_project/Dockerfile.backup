# ============================================================================
# PostgreSQL 16 Backup - Imagen oficial con cron
# ============================================================================
# Documentación: https://www.postgresql.org/docs/current/app-pgdump.html
# Herramienta: pg_dumpall (incluida en imagen oficial)
# ============================================================================
FROM postgres:16

LABEL maintainer="edugonmor"
LABEL description="PostgreSQL Backup Service with pg_dumpall and cron"
LABEL version="16"

# Instalar cron en BUILD TIME (no en runtime)
RUN apt-get update && apt-get install -y \
    cron \
    && rm -rf /var/lib/apt/lists/*

# Copiar scripts de backup
COPY docker/scripts/backup.sh /usr/local/bin/backup.sh
COPY docker/scripts/restore.sh /usr/local/bin/restore.sh
COPY docker/scripts/entrypoint-backup.sh /usr/local/bin/entrypoint-backup.sh

# Dar permisos de ejecución
RUN chmod +x /usr/local/bin/backup.sh \
    /usr/local/bin/restore.sh \
    /usr/local/bin/entrypoint-backup.sh

# Crear directorio de backups
RUN mkdir -p /backups

# Usar entrypoint personalizado que configura cron
ENTRYPOINT ["/usr/local/bin/entrypoint-backup.sh"]
