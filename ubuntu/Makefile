.PHONY: help setup setup-minimal verify status stable chrome vnc rclone backup-onedrive

help: ## Muestra esta ayuda
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'

# ------------------------------------------------------------------------------
# CONFIGURACI√ìN DEL SISTEMA
# ------------------------------------------------------------------------------

setup: ## Ejecuta configuraci√≥n inicial completa del sistema (requiere sudo)
	@echo "üîß Ejecutando configuraci√≥n inicial..."
	@sudo ./scripts/setup.sh --full
	@echo "‚úÖ Configuraci√≥n completada."

setup-minimal: ## Ejecuta solo configuraci√≥n de energ√≠a (requiere sudo)
	@echo "‚ö° Aplicando configuraci√≥n m√≠nima..."
	@sudo ./scripts/setup.sh --minimal
	@echo "‚úÖ Configuraci√≥n m√≠nima completada."

verify: ## Verifica estado de la configuraci√≥n
	@echo "üîç Verificando configuraci√≥n..."
	@./scripts/verify.sh

status: ## Muestra estado actual del sistema
	@echo "üìä Estado del sistema:"
	@echo ""
	@echo "=== Suspensi√≥n ==="
	@systemctl is-enabled sleep.target 2>/dev/null || echo "sleep.target: masked"
	@echo ""
	@echo "=== CPU Governor ==="
	@cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor 2>/dev/null || echo "No disponible"
	@echo ""
	@echo "=== GNOME Lock Screen ==="
	@gsettings get org.gnome.desktop.screensaver lock-enabled 2>/dev/null || echo "No disponible"

# ------------------------------------------------------------------------------
# INSTALACI√ìN DE SOFTWARE
# ------------------------------------------------------------------------------

chrome: ## Instala Google Chrome desde repositorio oficial (requiere sudo)
	@echo "üåê Instalando Google Chrome..."
	@sudo ./scripts/install/install-chrome.sh
	@echo "‚úÖ Chrome instalado."

vnc: ## Habilita servidor VNC para acceso remoto (requiere sudo)
	@echo "üñ•Ô∏è Configurando VNC..."
	@sudo ./scripts/install/configure-vnc-server.sh
	@echo "‚úÖ VNC configurado."

rclone: ## Instala rclone para sincronizaci√≥n cloud (requiere sudo)
	@echo "‚òÅÔ∏è Instalando rclone..."
	@sudo ./scripts/install/install-rclone.sh
	@echo "‚úÖ rclone instalado."

# ------------------------------------------------------------------------------
# BACKUP Y UTILIDADES
# ------------------------------------------------------------------------------

backup-onedrive: ## Ejecuta backup de OneDrive a disco local
	@echo "üíæ Ejecutando backup de OneDrive..."
	@./scripts/backup/backup-onedrive.sh
	@echo "‚úÖ Backup completado."

# ------------------------------------------------------------------------------
# SINCRONIZACI√ìN CON REPOSITORIO REMOTO
# ------------------------------------------------------------------------------
REPO_NAME ?= $(shell basename $(CURDIR))

stable: ## Push a repositorio remoto
	@echo "üöÄ Iniciando protocolo de despliegue estable..."
	@echo "üì¶ Repositorio: $(REPO_NAME)"
	git add .
	git commit -m "chore: sync $(REPO_NAME)" || true
	git push origin master
	@echo "‚úÖ Despliegue estable completado."
