.PHONY: help setup optimize verify status stable rclone rclone-config rclone-mount rclone-sync

help: ## Muestra esta ayuda
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'

setup: ## Ejecuta configuraci√≥n inicial del sistema (requiere sudo)
	@echo "üîß Ejecutando configuraci√≥n inicial..."
	@sudo ./scripts/setup.sh
	@echo "‚úÖ Configuraci√≥n completada."

optimize: ## Optimiza rendimiento del sistema (requiere sudo)
	@echo "‚ö° Optimizando sistema..."
	@sudo ./scripts/optimize.sh
	@echo "‚úÖ Optimizaci√≥n completada."

vnc: ## Habilita servidor VNC (requiere sudo)
	@echo "üñ•Ô∏è Configurando VNC..."
	@sudo ./scripts/enable-vnc.sh
	@echo "‚úÖ VNC configurado."

verify: ## Verifica estado de la configuraci√≥n
	@echo "üîç Verificando configuraci√≥n..."
	@./scripts/verify.sh

status: ## Muestra estado actual del sistema
	@echo "üìä Estado del sistema:"
	@echo ""
	@echo "=== Suspensi√≥n ==="
	@systemctl is-enabled sleep.target 2>/dev/null || echo "sleep.target: masked"
	@echo ""
	@echo "=== CPU Governor ==="
	@cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor 2>/dev/null || echo "No disponible"
	@echo ""
	@echo "=== GNOME Lock Screen ==="
	@gsettings get org.gnome.desktop.screensaver lock-enabled 2>/dev/null || echo "No disponible"
	@echo ""
	@echo "=== Rclone ==="
	@rclone version 2>/dev/null | head -1 || echo "No instalado"
	@echo ""
	@echo "=== Montajes Rclone ==="
	@mountpoint /mnt/disk2/rclone/gdrive 2>/dev/null && echo "GDrive: montado" || echo "GDrive: no montado"
	@mountpoint /mnt/disk2/rclone/onedrive 2>/dev/null && echo "OneDrive: montado" || echo "OneDrive: no montado"

# ------------------------------------------------------------------------------
# RCLONE - Sincronizaci√≥n con la nube
# ------------------------------------------------------------------------------

rclone: ## Instala rclone y dependencias (requiere sudo)
	@echo "‚òÅÔ∏è Instalando rclone..."
	@sudo ./scripts/install-rclone.sh
	@echo "‚úÖ Rclone instalado."

rclone-config: ## Configura remotos de rclone (GDrive, OneDrive)
	@echo "‚öôÔ∏è Configurando remotos rclone..."
	@./scripts/configure-rclone.sh

rclone-mount: ## Habilita servicios de montaje autom√°tico (requiere sudo)
	@echo "üìÅ Habilitando montajes rclone..."
	@sudo ./scripts/enable-rclone-mount.sh
	@echo "‚úÖ Montajes habilitados."

rclone-sync: ## Sincroniza configuraci√≥n de rclone con proyecto Docker
	@echo "üîÑ Sincronizando configuraci√≥n..."
	@./scripts/sync-rclone-config.sh
	@echo "‚úÖ Configuraci√≥n sincronizada."

# ------------------------------------------------------------------------------
# SINCRONIZACI√ìN CON REPOSITORIO REMOTO
# ------------------------------------------------------------------------------
REPO_NAME ?= $(shell basename $(CURDIR))

stable: ## Push a repositorio remoto
	@echo "üöÄ Iniciando protocolo de despliegue estable..."
	@echo "üì¶ Repositorio: $(REPO_NAME)"
	git add .
	git commit -m "chore: sync $(REPO_NAME)" || true
	git push origin main
	@echo "‚úÖ Despliegue estable completado."
