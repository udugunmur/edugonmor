.PHONY: help setup setup-minimal verify status stable chrome vnc rclone samba backup-onedrive

help: ## Muestra esta ayuda
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'

# ------------------------------------------------------------------------------
# CONFIGURACIÃ“N DEL SISTEMA
# ------------------------------------------------------------------------------

setup: ## Ejecuta configuraciÃ³n inicial completa del sistema (requiere sudo)
	@echo "ğŸ”§ Ejecutando configuraciÃ³n inicial..."
	@sudo ./scripts/setup.sh --full
	@echo "âœ… ConfiguraciÃ³n completada."

setup-minimal: ## Ejecuta solo configuraciÃ³n de energÃ­a (requiere sudo)
	@echo "âš¡ Aplicando configuraciÃ³n mÃ­nima..."
	@sudo ./scripts/setup.sh --minimal
	@echo "âœ… ConfiguraciÃ³n mÃ­nima completada."

verify: ## Verifica estado de la configuraciÃ³n
	@echo "ğŸ” Verificando configuraciÃ³n..."
	@./scripts/verify.sh

status: ## Muestra estado actual del sistema
	@echo "ğŸ“Š Estado del sistema:"
	@echo ""
	@echo "=== SuspensiÃ³n ==="
	@systemctl is-enabled sleep.target 2>/dev/null || echo "sleep.target: masked"
	@echo ""
	@echo "=== CPU Governor ==="
	@cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor 2>/dev/null || echo "No disponible"
	@echo ""
	@echo "=== GNOME Lock Screen ==="
	@gsettings get org.gnome.desktop.screensaver lock-enabled 2>/dev/null || echo "No disponible"

# ------------------------------------------------------------------------------
# INSTALACIÃ“N DE SOFTWARE
# ------------------------------------------------------------------------------

chrome: ## Instala Google Chrome desde repositorio oficial (requiere sudo)
	@echo "ğŸŒ Instalando Google Chrome..."
	@sudo ./scripts/install/install-chrome.sh
	@echo "âœ… Chrome instalado."

vnc: ## Habilita servidor VNC para acceso remoto (requiere sudo)
	@echo "ğŸ–¥ï¸ Configurando VNC..."
	@sudo ./scripts/install/configure-vnc-server.sh
	@echo "âœ… VNC configurado."

rclone: ## Instala rclone para sincronizaciÃ³n cloud (requiere sudo)
	@echo "â˜ï¸ Instalando rclone..."
	@sudo ./scripts/install/install-rclone.sh
	@echo "âœ… rclone instalado."

samba: ## Instala y configura Samba para compartir archivos vÃ­a SMB (requiere sudo)
	@echo "ğŸ—‚ï¸ Instalando Samba..."
	@sudo ./scripts/install/install-samba.sh
	@echo "âœ… Samba instalado."

# ------------------------------------------------------------------------------
# BACKUP Y UTILIDADES
# ------------------------------------------------------------------------------

backup-onedrive: ## Ejecuta backup de OneDrive a disco local
	@echo "ğŸ’¾ Ejecutando backup de OneDrive..."
	@./scripts/backup/backup-onedrive.sh
	@echo "âœ… Backup completado."

upload-gdrive: ## Sube archivos locales a Google Drive (udugunmur@gmail.com)
	@echo "â˜ï¸ Iniciando subida a Google Drive..."
	@./scripts/backup/upload-gdrive.sh
	@echo "âœ… Subida completada."

# ------------------------------------------------------------------------------
# SINCRONIZACIÃ“N CON REPOSITORIO REMOTO
# ------------------------------------------------------------------------------
REPO_NAME ?= $(shell basename $(CURDIR))

stable: ## Push a repositorio remoto
	@echo "ğŸš€ Iniciando protocolo de despliegue estable..."
	@echo "ğŸ“¦ Repositorio: $(REPO_NAME)"
	git add .
	git commit -m "chore: sync $(REPO_NAME)" || true
	git push origin master
	@echo "âœ… Despliegue estable completado."
