.PHONY: help setup optimize verify status stable

help: ## Muestra esta ayuda
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'

setup: ## Ejecuta configuraciÃ³n inicial del sistema (requiere sudo)
	@echo "ðŸ”§ Ejecutando configuraciÃ³n inicial..."
	@sudo ./scripts/setup.sh
	@echo "âœ… ConfiguraciÃ³n completada."

optimize: ## Optimiza rendimiento del sistema (requiere sudo)
	@echo "âš¡ Optimizando sistema..."
	@sudo ./scripts/optimize.sh
	@echo "âœ… OptimizaciÃ³n completada."

vnc: ## Habilita servidor VNC (requiere sudo)
	@echo "ðŸ–¥ï¸ Configurando VNC..."
	@sudo ./scripts/enable-vnc.sh
	@echo "âœ… VNC configurado."

rclone: ## Instala rclone para sincronizaciÃ³n cloud (requiere sudo)
	@echo "â˜ï¸ Instalando rclone..."
	@sudo ./scripts/install-rclone.sh
	@echo "âœ… rclone instalado."

backup-onedrive: ## Ejecuta backup de OneDrive a disco local
	@echo "ðŸ’¾ Ejecutando backup de OneDrive..."
	@./scripts/backup-onedrive.sh
	@echo "âœ… Backup completado."

verify: ## Verifica estado de la configuraciÃ³n
	@echo "ðŸ” Verificando configuraciÃ³n..."
	@./scripts/verify.sh

status: ## Muestra estado actual del sistema
	@echo "ðŸ“Š Estado del sistema:"
	@echo ""
	@echo "=== SuspensiÃ³n ==="
	@systemctl is-enabled sleep.target 2>/dev/null || echo "sleep.target: masked"
	@echo ""
	@echo "=== CPU Governor ==="
	@cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor 2>/dev/null || echo "No disponible"
	@echo ""
	@echo "=== GNOME Lock Screen ==="
	@gsettings get org.gnome.desktop.screensaver lock-enabled 2>/dev/null || echo "No disponible"

# ------------------------------------------------------------------------------
# SINCRONIZACIÃ“N CON REPOSITORIO REMOTO
# ------------------------------------------------------------------------------
REPO_NAME ?= $(shell basename $(CURDIR))

stable: ## Push a repositorio remoto
	@echo "ðŸš€ Iniciando protocolo de despliegue estable..."
	@echo "ðŸ“¦ Repositorio: $(REPO_NAME)"
	git add .
	git commit -m "chore: sync $(REPO_NAME)" || true
	git push origin main
	@echo "âœ… Despliegue estable completado."
